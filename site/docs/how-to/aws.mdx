---
sidebar_position: 1
slug: '/aws'
---

# Manage an AWS Account

IaSQL requires AWS credentials to manage the resources within an AWS account via an [IAM user](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html) with **Programmatic Access**. IAM users can be created through the [console/UI](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html#id_users_create_console) or [CLI](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html#id_users_create_cliwpsapi). Ensure that the IAM role has sufficient permissions to deploy and manage the infrastructure resources you are interested in. `AdministratorAccess` provides full access to deploy and manage all types of resources. `ReadOnlyAccess` access provides access to inspect all of the different kinds of existing resources but does not modify them or create new ones. The former provides full IaSQL support, while the latter only provides access to `SELECT` statements, and `INSERT/UPDATE/DELETE` statements will fail. Read more about IaSQL transactions [here](../concepts/transaction.md).

For standard AWS credentials there are two parts to each [access key](https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys), which youâ€™ll see in the IAM console/CLI after you create it, an id and a secret. It is possible to [generate temporary credentials with a limited lifespan](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_request.html), in which case you also have a session token that must be provided.

import useBaseUrl from '@docusaurus/useBaseUrl';
import ThemedImage from '@theme/ThemedImage';

<ThemedImage
  alt="Connect"
  sources={{
    light: useBaseUrl('/screenshots/connect.png'),
    dark: useBaseUrl('/screenshots/connect_dark.png'),
  }}
/>


## View existing AWS CLI credentials

The [AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html) creates a plaintext credentials file on your machine that contains the AWS access keys that the CLI has access to. The file is named `credentials` and is located inside the `.aws/` directory in your home directory.

```bash
$ cat ~/.aws/credentials

[default]
aws_access_key_id = <YOUR_ACCESS_KEY_ID>
aws_secret_access_key = <YOUR_SECRET_ACCESS_KEY>
```

## Add the necessary cloud services to the PostgreSQL database

Connect to your database and use the `iasql_install` IaSQL PostgreSQL [function](../modules/builtin/iasql_functions.md) which is already loaded into your database to install different [modules](../concepts/module.md) and start managing different parts of your cloud account. Many different clients can be used to [connect](../how-to/postgres.mdx) to a PostgreSQL database.

:::note

To see the available modules use the `modules_list` [function](../modules/builtin/iasql_functions.md) which will return a virtual table

:::

```sql
SELECT
  *
FROM
  iasql_install ('aws_iam', 'aws_cloudwatch', 'aws_ecr', 'aws_ecs_fargate', 'aws_elb', 'aws_security_group', 'aws_vpc');
```

## Restricting AWS credentials to specific regions

Sometimes, you may want or need to restrict access to a specific region. To do this, you will need to make sure that the credentials for the IAM role given to IaSQL have a policy that restricts access only to AWS resources in that region. This can be done by creating a custom policy and attaching it to the relevant IAM role. The following [guide](https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create.html) will walk you through creating a new policy. Your policy will need to look something like this:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "*",
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "aws:RequestedRegion": "us-west-2"
        }
      }
    }
  ]
}
```

You can replace 'us-west-2' with your desired region.

Once you have the policy in place, you need to update your IAM identity (user, user group or role) and [attach the new policy](https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage-attach-detach.html). By default, IaSQL attempts to load resources from all enabled regions. Assuming that our credentials only have access to a single region, let's say `us-west-2`, we need to run a specific query after connecting to our database to inform IaSQL that we only want to manage resources in that region:

```sql
-- Make sure our default region is `us-west-2` if we did not set it up correctly while connecting
SELECT * FROM default_aws_region('us-west-2');
-- Disable in IaSQL all other regions
UPDATE aws_regions SET is_enabled = FALSE WHERE is_default = FALSE;
```
