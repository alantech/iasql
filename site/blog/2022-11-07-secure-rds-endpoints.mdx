---
slug: rds-privatelink
title: Securely connect Amazon RDS using PrivateLink
authors: [yrobla]
---

# Securely connect Amazon RDS using PrivateLink

Do you have some database instances on RDS and wonder what's the most secure way to reach them?

When creating a database, AWS is giving some specific information about the hostnames and ports to be used. You can access those to reach to your databases, by using specific clients for MySQL, Postgres, etc...:

<img src="/img/how_to_connect_rds.png" />

On a public VPC, those endpoints will be public by default. But you should consider creating them under a
private VPC and access them internally, to grant additional security to those services that are critical.

AWS PrivateLink offers the possibility to securely access those services without exposing them to internet,
just using Amazon's private network.

### Do you want to know if you have it properly configured?

Please use this query to check it:

<!--- https://www.urlencoder.org/ -->

<a href="https://app.iasql.com/#/button/check_rds_endpoints/----%20Installing%20the%20needed%20modules%0ASELECT%20iasql_install%28%27aws_rds%27%29%3B%0ASELECT%20iasql_install%28%27aws_vpc%27%29%3B%0A%0A--%20Perform%20the%20query%20for%20endpoints%0Aselect%20RDS.region%2C%20vpc.is_default%2C%20vpc.cidr_block%2C%0A%28select%20count%28%2A%29%3E0%20from%20endpoint_interface%20where%20endpoint_interface.region%3DRDS.region%20and%20service%3D%27rds%27%20and%20endpoint_interface.vpc_id%3Dvpc.id%29%20as%20has_endpoint_interface%0Afrom%20RDS%20left%20outer%20join%20vpc%20on%20vpc.region%3DRDS.region%3B">
  <button class="button button--lg button--primary">Run SQL to check your endpoints</button>
</a>

```
 ---- Installing the needed modules
SELECT
  iasql_install ('aws_rds');

SELECT
  iasql_install ('aws_vpc');

-- Perform the query for endpoints
SELECT
  RDS.region,
  vpc.is_default,
  vpc.cidr_block,
  (
    SELECT
      COUNT(*) > 0
    FROM
      endpoint_interface
    WHERE
      endpoint_interface.region = RDS.region
      AND service = 'rds'
      AND endpoint_interface.vpc_id = vpc.id
  ) AS has_endpoint_interface
FROM
  RDS
  LEFT OUTER JOIN vpc ON vpc.region = RDS.region;
```

Have you found missing endpoints? No problem, IaSQL can generate missing Endpoint Interfaces for you.

<a href="https://app.iasql.com/#/button/add_rds_endpoint_interfaces/--%20Inserts%20the%20missing%20endpoints%0Ainsert%20into%20endpoint_interface%28region%2C%20vpc_id%2C%20service%2C%20private_dns_enabled%29%20select%20RDS.region%2C%20vpc.id%2C%20%27rds%27%2C%20true%20from%20RDS%20inner%20join%20vpc%0Aon%20RDS.region%3Dvpc.region%20where%20not%20exists%20%28select%20id%20from%20endpoint_interface%20where%20endpoint_interface.region%3DRDS.region%20and%20endpoint_interface.vpc_id%3Dvpc.id%29%3B%0A--%20Preview%20the%20changes%0Aselect%20%2A%20from%20iasql_preview_apply%28%29%3B%0A--%20Apply%20the%20changes%0A--select%20%2A%20from%20iasql_apply%28%29%3B">
  <button class="button button--lg button--primary">Add missing endpoint interfaces</button>
</a>

```
 -- Inserts the missing endpoints
INSERT INTO
  endpoint_interface (region, vpc_id, service, private_dns_enabled)
SELECT
  RDS.region,
  vpc.id,
  'rds',
  TRUE
FROM
  RDS
  INNER JOIN vpc ON RDS.region = vpc.region
WHERE
  NOT EXISTS (
    SELECT
      id
    FROM
      endpoint_interface
    WHERE
      endpoint_interface.region = RDS.region
      AND endpoint_interface.vpc_id = vpc.id
  );

-- Preview the changes
SELECT
  *
FROM
  iasql_preview_apply ();

-- Apply the changes
--select * from iasql_apply();
```

By clicking on the button, our engine will auto-generate the missing endpoint interfaces and will allow you to preview the changes to be applied on your cloud. Once you are OK with the results, you can uncomment the `iasql_apply` query and it will create the endpoints for you.

### Testing the result

After running the query, you should have Endpoint Interfaces created for your RDS resources. Those should be on the region and VPC where you had your databases:

<div class="col col--12">
  <img src="/img/rds_endpoint_interfaces_created.png" height="200" />
</div>

In order to start testing the result, you can start a new EC2 instance on a private VPC, on the same region
where your RDS and Endpoint interface is configured. You can double check that there is no internet
connectivity. But the RDS endpoint could still be reached, by using the interface that has been created:

<div class="col col--12">
  <img src="/img/access_rds_endpoint.png" height="200" />
</div>

Please note that you could only use those endpoints from the same region. You could reach the services in multiple regions with the use of <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html" target="_blank">
VPC peering</a>
