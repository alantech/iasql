---
slug: deploy-ghost-ec2
title: Deploy Ghost in EC2 with one click
date: 2022-11-23
authors: [yrobla]
---

# Deploy <a href="https://ghost.org/">Ghost</a> with one click

Ghost is a powerful app for new-media creators to publish, share, and grow a business around their content. It comes with modern tools to build a website, publish content, send newsletters & offer paid
subscriptions to members.

Ghost is a software as a service product, but it is totally built on open source and offers a self-hosted, installable version. This version can be hosted on AWS using several approaches, and one of them
is to host into an EC2 instance.

Starting an EC2 instance and manually triggering the installation commands is a procedure that can be done manually, but there are also another dependencies involved, such as the creation of proper security groups.
It is also a time-consuming task, specially if you need to install several instances. This article will offer a way to install Ghost with one-click on IaSQL using an EC2 instance on Ubuntu as highlighted <a href="https://ghost.org/docs/install/ubuntu/">here</a>.

```sql TheButton[Install Ghost]="Install Ghost"
 -- Install modules
SELECT
  *
FROM
  iasql_install ('aws_ec2', 'aws_ec2_metadata');

-- insert security groups
INSERT INTO
  security_group (description, group_name)
VALUES
  ('Ghost security group', 'ghost_sg_group');

INSERT INTO
  security_group_rule (is_egress, ip_protocol, from_port, to_port, cidr_ipv4, description, security_group_id)
SELECT
  FALSE,
  'tcp',
  22,
  22,
  '0.0.0.0/0',
  'ghost_sg_group_rule_ssh',
  id
FROM
  security_group
WHERE
  group_name = 'ghost_sg_group';

INSERT INTO
  security_group_rule (is_egress, ip_protocol, from_port, to_port, cidr_ipv4, description, security_group_id)
SELECT
  FALSE,
  'tcp',
  80,
  80,
  '0.0.0.0/0',
  'ghost_sg_group_rule_http',
  id
FROM
  security_group
WHERE
  group_name = 'ghost_sg_group';

INSERT INTO
  security_group_rule (is_egress, ip_protocol, from_port, to_port, cidr_ipv4, description, security_group_id)
SELECT
  FALSE,
  'tcp',
  443,
  443,
  '0.0.0.0/0',
  'ghost_sg_group_rule_https',
  id
FROM
  security_group
WHERE
  group_name = 'ghost_sg_group';

INSERT INTO
  security_group_rule (is_egress, ip_protocol, from_port, to_port, cidr_ipv4, description, security_group_id)
SELECT
  TRUE,
  'tcp',
  1,
  65335,
  '0.0.0.0/0',
  'ghost_sg_group_rule_egress',
  id
FROM
  security_group
WHERE
  group_name = 'ghost_sg_group';

-- insert instance with the right userdata
INSERT INTO
  instance (ami, instance_type, subnet_id, tags, user_data, region)
SELECT
  'resolve:ssm:/aws/service/canonical/ubuntu/server/22.04/stable/current/amd64/hvm/ebs-gp2/ami-id',
  't2.small',
  subnet.id,
  '{"name":"ghost-blog"}',
  '#!/bin/bash
useradd -m ghostuser
usermod -a -G sudo ghostuser
echo "ghostuser ALL=(ALL:ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/ghostuser
sudo -E apt-get update -y
sudo -E apt-get upgrade -y
sudo -E apt-get -y install nginx
sudo -E ufw allow "Nginx Full"
sudo -E apt-get -y install mysql-server
sudo -E mysql -u root -e "ALTER USER "root"@"localhost" IDENTIFIED WITH mysql_native_password BY \"ghost\";"
curl -sL https://deb.nodesource.com/setup_16.x | sudo -E bash
sudo -E apt-get -y install nodejs
sudo npm install ghost-cli@latest -g
sudo -E mkdir -p /var/www/ghost
sudo -E chown ghostuser /var/www/ghost
sudo chmod 775 /var/www/ghost
cd /var/www/ghost/
sudo -u ghostuser ghost install --url http://$(curl http://169.254.169.254/latest/meta-data/public-ipv4) --db mysql --dbpass ghost --no-prompt --start --enable
',
  'us-east-2'
FROM
  subnet
  INNER JOIN vpc ON vpc.id = subnet.vpc_id
  AND vpc.is_default = 'Y'
WHERE
  vpc.region = 'us-east-2'
  AND subnet.availability_zone = 'us-east-2a'
LIMIT
  1;

-- insert instance security groups
INSERT INTO
  instance_security_groups (instance_id, security_group_id)
SELECT
  (
    SELECT
      id
    FROM
      instance
    WHERE
      tags ->> 'name' = 'ghost-blog'
    LIMIT
      1
  ),
  (
    SELECT
      id
    FROM
      security_group
    WHERE
      group_name = 'ghost_sg_group'
      AND region = 'us-east-2'
    LIMIT
      1
  );

SELECT
  *
FROM
  iasql_commit ();
```

After the process finishes (it will take over 10-15 minutes), you will have your Ghost instance installed, publicly accessible through the public IP of the spinned instance.
You can get the details of the public IP of your instance querying for the metadata:

```sql
SELECT
  *
FROM
  iasql_commit ();

SELECT
  public_ip_address
FROM
  instance_metadata
WHERE
  id = (
    SELECT
      id
    FROM
      instance
    WHERE
      tags ->> 'name' = 'ghost-blog'
    LIMIT
      1
  );
```

The initial Ghost installation will be available on the browser just query by `http://<public_ip_address>/ghost`:

<img src="/img/configure_ghost.png" style={{ maxWidth: 600 }} />

This is the basic installation of Ghost, but it is just meant for development and testing purposes. Once you are satisfied with the setup,
you can continue to an advanced deployment of Ghost meant for production. This will come in next posts from IaSQL.
