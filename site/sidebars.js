/**
 * Creating a sidebar enables you to:
 - create an ordered group of docs
 - render a sidebar for each doc of that group
 - provide next/previous navigation

 The sidebars can be generated from the filesystem, or explicitly defined here.

 Create as many sidebars as you want.
 */

async function getSectionLinks(section) {
  var fs = require('fs');
  var path = require('path');
  var filesPath = path.join(__dirname, 'docs', 'modules', section);

  let files = fs.readdirSync(filesPath);

  const items = [];
  for (const file of files) {
    if (file.endsWith('.md') && !file.includes('entity') && !file.includes('_rpcs')) {
      // just strip md
      const name = file.split('.')[0];
      items.push({
        type: 'doc',
        label: name,
        id: `modules/${section}/${name}`,
        customProps: {
          label: name,
        },
      });
    }
  }
  return items;
}
async function getDocsLinks() {
  const items = [
    {
      type: 'doc',
      label: 'Index',
      id: 'modules/index',
      customProps: {
        fragment: '',
        label: 'Index',
      },
    },
    {
      type: 'category',
      label: 'Builtin',
      collapsible: true,
      collapsed: true,
      items: await getSectionLinks('builtin'),
    },
    {
      type: 'category',
      label: 'AWS',
      collapsible: true,
      collapsed: true,
      items: await getSectionLinks('aws'),
    },
    {
      type: 'category',
      label: 'Server (via SSH)',
      collapsible: true,
      collapsed: true,
      items: await getSectionLinks('ssh'),
    },
  ];

  return items;
}

module.exports = (async function () {
  // By default, Docusaurus generates a sidebar from the docs folder structure
  const items = await getDocsLinks();
  return {
    docs: [
      'getting-started',
      {
        type: 'category',
        label: 'How-to guides',
        collapsible: true,
        collapsed: true,
        items: [
          {
            type: 'autogenerated',
            dirName: 'how-to',
          },
        ],
      },
      {
        type: 'category',
        label: 'Concepts',
        collapsible: true,
        collapsed: true,
        items: [
          {
            type: 'autogenerated',
            dirName: 'concepts',
          },
        ],
      },
      {
        type: 'category',
        label: 'Modules',
        collapsible: true,
        collapsed: true,
        items: items,
      },
    ],
  };
})();
