/**
 * Creating a sidebar enables you to:
 - create an ordered group of docs
 - render a sidebar for each doc of that group
 - provide next/previous navigation

 The sidebars can be generated from the filesystem, or explicitly defined here.

 Create as many sidebars as you want.
 */
async function getDocsLinks() {
  // read all documents at directory
  var fs = require('fs');
  var path = require('path');
  var filesPath = path.join(__dirname, 'docs', 'modules', 'aws');

  let files = fs.readdirSync(filesPath);

  // read aws
  const aws_items = [];
  for (const file of files) {
    if (file.endsWith('.md') && !file.includes('entity') && !file.includes('_rpcs')) {
      // just strip md
      const name = file.split('.')[0];
      aws_items.push({
        type: 'doc',
        label: name,
        id: 'modules/aws/' + name,
        customProps: {
          label: name,
        },
      });
    }
  }

  // add global
  const items = [
    {
      type: 'doc',
      label: 'Index',
      id: 'modules/index',
      customProps: {
        fragment: '',
        label: 'Index',
      },
    },
    {
      type: 'category',
      label: 'Builtin',
      collapsible: true,
      collapsed: true,
      items: [
        {
          type: 'doc',
          label: 'iasql_functions',
          id: 'modules/builtin/iasql_functions',
          customProps: {
            fragment: '',
            label: 'iasql_functions',
          },
        },
      ],
    },
    {
      type: 'category',
      label: 'AWS',
      collapsible: true,
      collapsed: true,
      items: aws_items,
    },
  ];

  return items;
}

module.exports = (async function () {
  // By default, Docusaurus generates a sidebar from the docs folder structure
  const items = await getDocsLinks();
  return {
    docs: [
      'getting-started',
      {
        type: 'category',
        label: 'How-to guides',
        collapsible: true,
        collapsed: true,
        items: [
          {
            type: 'autogenerated',
            dirName: 'how-to',
          },
        ],
      },
      {
        type: 'category',
        label: 'Concepts',
        collapsible: true,
        collapsed: true,
        items: [
          {
            type: 'autogenerated',
            dirName: 'concepts',
          },
        ],
      },
      {
        type: 'category',
        label: 'Modules',
        collapsible: true,
        collapsed: true,
        items: items,
      },
    ],
  };
})();
