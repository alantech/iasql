<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Why SQL is right for Infrastructure Management | IaSQL</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://iasql.com/blog/why-sql-for-infrastructure/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Why SQL is right for Infrastructure Management | IaSQL"><meta data-rh="true" name="description" content="Infrastructure is the heart of your company. Without it, nothing can actually be done and there&#x27;d be no reason for customers to pay you. For software companies that infrastructure is the software that its engineers directly write, and usually the cloud infrastructure and services it runs on top of and integrates with."><meta data-rh="true" property="og:description" content="Infrastructure is the heart of your company. Without it, nothing can actually be done and there&#x27;d be no reason for customers to pay you. For software companies that infrastructure is the software that its engineers directly write, and usually the cloud infrastructure and services it runs on top of and integrates with."><meta data-rh="true" property="og:image" content="https://iasql.com/home/iasql-connector.gif"><meta data-rh="true" name="twitter:image" content="https://iasql.com/home/iasql-connector.gif"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-04-06T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="deep-dives"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://iasql.com/blog/why-sql-for-infrastructure/"><link data-rh="true" rel="alternate" href="https://iasql.com/blog/why-sql-for-infrastructure/" hreflang="en"><link data-rh="true" rel="alternate" href="https://iasql.com/blog/why-sql-for-infrastructure/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://5D0XPJ20G6-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="IaSQL RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="IaSQL Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="IaSQL" href="/opensearch.xml">
<link rel="preconnect" href="https://app.posthog.com">
<script>!function(t,e){var o,p,i,n;e.__SV||(window.posthog=e,e._i=[],e.init=function(r,s,a){function c(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(i=t.createElement("script")).type="text/javascript",i.async=!0,i.src=s.api_host+"/static/array.js",(n=t.getElementsByTagName("script")[0]).parentNode.insertBefore(i,n);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset".split(" "),p=0;p<o.length;p++)c(u,o[p]);e._i.push([r,s,a])},e.__SV=1)}(document,window.posthog||[]),posthog.init("phc_WjwJsXXSuEl2R2zElUWL55mWpNIfWR8HrFvjxwlTGWH",{api_host:"https://app.posthog.com",id:"default"})</script>

<script src="/js/js.cookie.min.js" async></script>
<script src="/js/lz-string.min.js" async></script><link rel="stylesheet" href="/assets/css/styles.8b61a1c1.css">
<link rel="preload" href="/assets/js/runtime~main.d268cc66.js" as="script">
<link rel="preload" href="/assets/js/main.7045c60e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_ToTc themedImage--light_HNdA" width="70"><img src="/img/logo_dark.png" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU" width="70"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" target="_self" href="/docs/">Docs</a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/alantech/iasql" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/why-sql-for-infrastructure/">Why SQL is right for Infrastructure Management</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/deploy-stable-diffusion/">Deploy Stable Diffusion in EC2 using a SQL query</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/save-s3-vpc/">Save $ on public S3 buckets using VPC endpoints via SQL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/rds-privatelink/">Securely connect to an Amazon RDS via PrivateLink using SQL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/deploy-static-website/">Deploy a Static Website on AWS using SQL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/beta/">IaSQL is in beta!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ecr-save/">Save on AWS by deleting untagged ECR images</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ecs-simplified/">Deploying to ECS, Simplified!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/django/">Deploy containerized app to Fargate (Django)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/prisma/">Deploy containerized app to Fargate (Prisma)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/fargate/">Deploy containerized app to ECS Fargate</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/os-iasql/">UPDATE iasql SET source = &#x27;open&#x27;;</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/intro-iasql/">Introduction to Infrastructure as SQL</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://iasql.com/home/iasql-connector.gif"><header><h1 class="title_f1Hy" itemprop="headline">Why SQL is right for Infrastructure Management</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-04-06T00:00:00.000Z" itemprop="datePublished">April 6, 2023</time> · <!-- -->30 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo" src="https://github.com/dfellis.png" alt="David Ellis"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">David Ellis</span></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo" src="https://github.com/depombo.png" alt="L. Fernando De Pombo"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">L. Fernando De Pombo</span></div></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>Infrastructure is the heart of your company. Without it, nothing can actually be done and there&#x27;d be no reason for customers to pay you. For software companies that infrastructure is the software that its engineers directly write, and usually the cloud infrastructure and services it runs on top of and integrates with.</p><p>In this post, we will geek out on various software abstractions and data structures, tools used by professionals of various sorts, and dig into the pros and cons of these with respect to cloud infrastructure management in particular. We&#x27;ll see that while SQL has its own warts, it is the &quot;least worst&quot; of all of the options out there.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="following-these-instructions-is-imperative">Following these instructions is imperative<a href="#following-these-instructions-is-imperative" class="hash-link" aria-label="Direct link to Following these instructions is imperative" title="Direct link to Following these instructions is imperative">​</a></h2><p>The simplest way to define how to set something up is to write up a list of instructions to follow, in order, to build whatever infrastructure you&#x27;re dealing with, whether its the instructions on how to build a restaurant or an AWS Fargate cluster. This list of steps to process (with a LISt Processor, or <a href="https://en.wikipedia.org/wiki/Lisp_%28programming_language%29" target="_blank" rel="noopener noreferrer">LISP</a>, if you will 😉), which can include instructions to repeat or skip over steps based on conditions you have run into, is called <a href="https://en.wikipedia.org/wiki/Imperative_programming" target="_blank" rel="noopener noreferrer">imperative programming</a> in the software world.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Imperative Restaurant Instructions</div><div class="admonitionContent_S0QG"><p><img loading="lazy" alt="Man in hard-hat builds your restaurant" src="/assets/images/man-in-hard-hat-builds-your-restaurant-be287ab94e185066bad43b4af39c15fb.png" width="512" height="512" class="img_CujE"></p><ol><li>Design restaurant.</li><li>Flatten the ground.</li><li>Prop up pieces of wood next to each other.</li><li>Bang nails into wood.</li><li>Is restaurant finished? No, go to 3.</li></ol></div></div><p>For your cloud infrastructure, this is similar to using the <a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/" target="_blank" rel="noopener noreferrer">AWS SDK</a> and directly calling the various methods, checking their results and eventually arriving at the desired infrastructure. It is <em>also</em> like following a step-by-step guide clicking through the various AWS console UI elements to set up your infrastructure, like in <a href="https://towardsdatascience.com/deploy-your-python-app-with-aws-fargate-tutorial-7a48535da586" target="_blank" rel="noopener noreferrer">this guide</a>. The latter may not be automated, to you, but to your company executives it is as they don&#x27;t care how the infrastructure building was accomplished as long as it was done quickly, cheaply, and reliably, and you know they always want all three. 😉</p><p>Imperative infrastructure management works <em>well</em> for initial setup of new infrastructure. There&#x27;s nothing there to interfere with it, so you can just write the &quot;happy path&quot; and get it working. And if that fails, you can just tear it all down and start all over again if that&#x27;s cheap, which it is for cloud infrastructure (though not for building a restaurant), so the <a href="https://en.wikipedia.org/wiki/Cyclomatic_complexity" target="_blank" rel="noopener noreferrer">cyclomatic complexity</a> of the code you write is low and everyone can follow along with it. For example, one can use the <a href="https://aws.amazon.com/cli/" target="_blank" rel="noopener noreferrer"><code>aws</code> cli application</a> inside of a <a href="https://www.gnu.org/software/bash/" target="_blank" rel="noopener noreferrer"><code>bash</code> script</a> to create a new <a href="https://en.wikipedia.org/wiki/Ssh-keygen" target="_blank" rel="noopener noreferrer">ssh keypair</a> in AWS, a <a href="https://docs.aws.amazon.com/vpc/latest/userguide/security-groups.html" target="_blank" rel="noopener noreferrer">security group</a> enabling ssh access, a new EC2 instance associated with both, and then access that instance (to demonstrate that it works).</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">aws ec2 create-key-pair </span><span class="token punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  --region us-west-2 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  --key-name login </span><span class="token punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  --key-type ed25519 </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  jq -r .KeyMaterial </span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> login.pem</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">chmod</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">600</span><span class="token plain"> login.pem</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(201, 103, 101)">SG_ID</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token variable" style="color:rgb(201, 103, 101)">$(</span><span class="token variable" style="color:rgb(201, 103, 101)">aws ec2 create-security-group </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --group-name login-sg </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --description </span><span class="token variable string" style="color:rgb(72, 118, 214)">&quot;Login security group&quot;</span><span class="token variable" style="color:rgb(201, 103, 101)"> </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --region us-west-2 </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --vpc-id </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">$(</span><span class="token variable" style="color:rgb(201, 103, 101)">aws ec2 describe-vpcs </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">    --region us-west-2 </span><span class="token variable operator" style="color:rgb(12, 150, 155)">|</span><span class="token variable" style="color:rgb(201, 103, 101)"> </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">    jq -r </span><span class="token variable string" style="color:rgb(72, 118, 214)">&#x27;.Vpcs[] | select(.IsDefault = true) | .VpcId&#x27;</span><span class="token variable" style="color:rgb(201, 103, 101)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  jq -r .GroupId</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">aws ec2 authorize-security-group-ingress </span><span class="token punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  --group-name login-sg </span><span class="token punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  --region us-west-2 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  --ip-permissions </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;IpProtocol=tcp,FromPort=22,ToPort=22,IpRanges=[{CidrIp=0.0.0.0/0}]&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(201, 103, 101)">INSTANCE_ID</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token variable" style="color:rgb(201, 103, 101)">$(</span><span class="token variable" style="color:rgb(201, 103, 101)">aws ec2 run-instances </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --region us-west-2 </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --subnet-id </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">$(</span><span class="token variable" style="color:rgb(201, 103, 101)">aws ec2 describe-subnets </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">    --region us-west-2 </span><span class="token variable operator" style="color:rgb(12, 150, 155)">|</span><span class="token variable" style="color:rgb(201, 103, 101)"> </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">    jq -r .Subnets</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token variable number" style="color:rgb(170, 9, 130)">0</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token variable" style="color:rgb(201, 103, 101)">.SubnetId</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token variable" style="color:rgb(201, 103, 101)"> </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --instance-type t3.small </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --image-id resolve:ssm:/aws/service/canonical/ubuntu/server/20.04/stable/current/amd64/hvm/ebs-gp2/ami-id </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --security-group-ids $</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token variable" style="color:rgb(201, 103, 101)">SG_ID</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token variable" style="color:rgb(201, 103, 101)"> </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --key-name login </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --associate-public-ip-address </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --tag-specifications </span><span class="token variable string" style="color:rgb(72, 118, 214)">&#x27;ResourceType=instance,Tags=[{Key=name,Value=login-inst}]&#x27;</span><span class="token variable" style="color:rgb(201, 103, 101)"> </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --output json </span><span class="token variable operator" style="color:rgb(12, 150, 155)">|</span><span class="token variable" style="color:rgb(201, 103, 101)"> </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  jq -r .Instances</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token variable number" style="color:rgb(170, 9, 130)">0</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token variable" style="color:rgb(201, 103, 101)">.InstanceId</span><span class="token variable" style="color:rgb(201, 103, 101)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(17, 17, 17)">echo</span><span class="token plain"> EC2 instance </span><span class="token variable" style="color:rgb(201, 103, 101)">${INSTANCE_ID}</span><span class="token plain"> starting </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">aws ec2 </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">wait</span><span class="token plain"> instance-status-ok </span><span class="token punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  --region us-west-2 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  --instance-ids </span><span class="token variable" style="color:rgb(201, 103, 101)">${INSTANCE_ID}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(201, 103, 101)">PUBLIC_IP</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token variable" style="color:rgb(201, 103, 101)">$(</span><span class="token variable" style="color:rgb(201, 103, 101)">aws ec2 describe-instances </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --region us-west-2 </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --filters </span><span class="token variable assign-left variable" style="color:rgb(201, 103, 101)">Name</span><span class="token variable operator" style="color:rgb(12, 150, 155)">=</span><span class="token variable" style="color:rgb(201, 103, 101)">tag:name,Values</span><span class="token variable operator" style="color:rgb(12, 150, 155)">=</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token variable" style="color:rgb(201, 103, 101)">login-inst</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token variable" style="color:rgb(201, 103, 101)"> </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --filters </span><span class="token variable assign-left variable" style="color:rgb(201, 103, 101)">Name</span><span class="token variable operator" style="color:rgb(12, 150, 155)">=</span><span class="token variable" style="color:rgb(201, 103, 101)">instance-state-name,Values</span><span class="token variable operator" style="color:rgb(12, 150, 155)">=</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token variable" style="color:rgb(201, 103, 101)">running</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token variable" style="color:rgb(201, 103, 101)"> </span><span class="token variable operator" style="color:rgb(12, 150, 155)">|</span><span class="token variable" style="color:rgb(201, 103, 101)"> </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  jq -r .Reservations</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token variable number" style="color:rgb(170, 9, 130)">0</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token variable" style="color:rgb(201, 103, 101)">.Instances</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token variable number" style="color:rgb(170, 9, 130)">0</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token variable" style="color:rgb(201, 103, 101)">.PublicIpAddress</span><span class="token variable" style="color:rgb(201, 103, 101)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(17, 17, 17)">echo</span><span class="token plain"> Server accessible at </span><span class="token variable" style="color:rgb(201, 103, 101)">${PUBLIC_IP}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">ssh</span><span class="token plain"> -i login.pem -o </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;StrictHostKeyChecking no&quot;</span><span class="token plain"> ubuntu@</span><span class="token variable" style="color:rgb(201, 103, 101)">${PUBLIC_IP}</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">uname</span><span class="token plain"> -a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Keep in mind that this is a <em>simple</em> script that does not handle failure of any of the commands called, creating one EC2 instance with two supporting elements (a security group to allow access to the SSH port and an SSH keypair to log into the instance). If you intend to actually use it multiple times, several of the arguments currently hardwired should be turned into shell arguments themselves, and all of the error paths should be tackled.</p><p>However, the vast majority of the time you are not creating clones of the same infrastructure over and over again, instead you need to make changes to your existing infrastructure, and that original code is more than likely useless to you. To get from the <em>current</em> state of your infrastructure to your <em>desired</em> state, you need to call different APIs than you did before, and its much riskier to make a mistake because this infrastructure is already in use.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="declare-your-intentions-at-once">Declare your intentions at once<a href="#declare-your-intentions-at-once" class="hash-link" aria-label="Direct link to Declare your intentions at once" title="Direct link to Declare your intentions at once">​</a></h2><p>When the desired state is relatively simple to define and the mechanism to reach that state is not that important, writing up a declaration of what is needed and letting something/someone else deal with it is the most logical abstraction. This would be like drafting up the architectural draft for your new restaurant and paying a contracting company to actually build it, or <a href="https://en.wikipedia.org/wiki/Declarative_programming#Domain-specific_languages" target="_blank" rel="noopener noreferrer">writing HTML and letting a web browser render it</a>, or writing a <a href="https://github.com/hashicorp/hcl" target="_blank" rel="noopener noreferrer">Terraform HCL</a> file and letting the Terraform CLI tool <code>apply</code> it. This is called <a href="https://en.wikipedia.org/wiki/Declarative_programming" target="_blank" rel="noopener noreferrer">declarative programming</a> in the software world, and has many advantages (and a few disadvantages!) for cloud infrastructure management.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Declarative Restaurant Instructions</div><div class="admonitionContent_S0QG"><p><img loading="lazy" alt="King in robes on throne" src="/assets/images/king-in-robes-on-throne-ef35edfba29b0bdbf9bd5449390df201.png" width="512" height="512" class="img_CujE"></p><p><em>By decree of the king, a restaurant shall be built!</em></p></div></div><p>In declarative programming you have some initial state and in comparatively dense and high-level declarative code define the desired state. In many use-cases (like web browsers and sometimes for restaurant-building contractors) the initial state is &quot;blank&quot; and the engine that transforms the declarative code into imperative operations can often be a relatively straightforward <a href="https://en.wikipedia.org/wiki/Interpreter_%28computing%29" target="_blank" rel="noopener noreferrer">interpreter</a> walking the <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" target="_blank" rel="noopener noreferrer">AST</a> of the declarative code.</p><p>Infrastructure management <em>generally</em> is not that straightforward. Changes to infrastructure require in-place mutations of the current state or a full <a href="https://en.wikipedia.org/wiki/Blue-green_deployment" target="_blank" rel="noopener noreferrer">blue/green deployment</a> of the entirety of your production infrastructure is very expensive, requiring all resource costs to be doubled, and deployments to require some amount of downtime for users to swap over and state to be resynchronized. Particularly for databases this approach is essentially impossible as there is too much state to swap, which is what makes database migrations tricky when dropping data.</p><p>So declarative programming for infrastructure, also known as <a href="https://en.wikipedia.org/wiki/Infrastructure_as_code" target="_blank" rel="noopener noreferrer">Infrastructure as Code</a>, must take the existing state and generate the imperative operations to perform based on the differences between the existing state and the declared desired state. This is like a contracting company being given an architecture draft for a new restaurant and being told to remodel an existing commercial space (maybe it was also a restaurant, maybe it was a clothing store, etc) and the contracting company figuring out what needs to be torn down first, what can be re-used, and what needs to be built new.</p><div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">terraform</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">required_providers</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token property" style="color:rgb(12, 150, 155)">aws</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">source</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;hashicorp/aws&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">version</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;4.60.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">data </span><span class="token keyword type variable" style="color:rgb(201, 103, 101)">&quot;external&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;example&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">program</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;bash&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;-c&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token heredoc string" style="color:rgb(72, 118, 214)">&lt;&lt;-EOT</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">      if [ ! -f ./login.pem ]; then</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">        # Terraform doesn&#x27;t support creating the PEM file via AWS. It has to be</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">        # created locally and then imported into AWS. Inside of a conditional so</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">        # we don&#x27;t accidentally re-create the file between &#x27;plan&#x27; and &#x27;apply&#x27;</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">        yes &#x27;&#x27; | ssh-keygen -t ed25519 -m PEM -f login.pem</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">      fi</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">      chmod 600 login.pem</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">      # The output of this script needs to be JSON formatted. This is a bit wonky</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">      # but building it over time via &#x27;jq&#x27; operators is actually harder to follow</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">      echo {</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">      echo   &#x27;&quot;access_key_id&quot;: &quot;&#x27;$(aws configure get aws_access_key_id)&#x27;&quot;,&#x27;</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">      echo   &#x27;&quot;secret_access_key&quot;: &quot;&#x27;$(aws configure get aws_secret_access_key)&#x27;&quot;,&#x27;</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">      echo   &#x27;&quot;public_key&quot;: &quot;&#x27;$(cat login.pem.pub)&#x27;&quot;&#x27;</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">      echo }</span><br></span><span class="token-line" style="color:#403f53"><span class="token heredoc string" style="color:rgb(72, 118, 214)">    EOT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">provider</span><span class="token keyword type variable" style="color:rgb(201, 103, 101)"> &quot;aws&quot; </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">region</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;us-west-2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">access_key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> data.external.example.result</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;access_key_id&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">secret_key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> data.external.example.result</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;secret_access_key&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">resource </span><span class="token keyword type variable" style="color:rgb(201, 103, 101)">&quot;aws_key_pair&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">key_name</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">public_key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> data.external.example.result</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;public_key&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">resource </span><span class="token keyword type variable" style="color:rgb(201, 103, 101)">&quot;aws_security_group&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login_sg&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">name</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login-sg&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">description</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Login security group&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">ingress</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token property" style="color:rgb(12, 150, 155)">from_port</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token property" style="color:rgb(12, 150, 155)">to_port</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token property" style="color:rgb(12, 150, 155)">protocol</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;tcp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token property" style="color:rgb(12, 150, 155)">cidr_blocks</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;0.0.0.0/0&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">resource </span><span class="token keyword type variable" style="color:rgb(201, 103, 101)">&quot;aws_instance&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">ami</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;resolve:ssm:/aws/service/canonical/ubuntu/server/20.04/stable/current/amd64/hvm/ebs-gp2/ami-id&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">instance_type</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;t3.small&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">associate_public_ip_address</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">key_name</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> aws_key_pair.login.key_name</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">vpc_security_group_ids</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">aws_security_group.login_sg.id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">tags</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token property" style="color:rgb(12, 150, 155)">name</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login-inst&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This example still requires the following lines from the imperative example to get the public IP address of the new EC2 instance and log into it:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token assign-left variable" style="color:rgb(201, 103, 101)">PUBLIC_IP</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token variable" style="color:rgb(201, 103, 101)">$(</span><span class="token variable" style="color:rgb(201, 103, 101)">aws ec2 describe-instances </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --region us-west-2 </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --filters </span><span class="token variable assign-left variable" style="color:rgb(201, 103, 101)">Name</span><span class="token variable operator" style="color:rgb(12, 150, 155)">=</span><span class="token variable" style="color:rgb(201, 103, 101)">tag:name,Values</span><span class="token variable operator" style="color:rgb(12, 150, 155)">=</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token variable" style="color:rgb(201, 103, 101)">login-inst</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token variable" style="color:rgb(201, 103, 101)"> </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  --filters </span><span class="token variable assign-left variable" style="color:rgb(201, 103, 101)">Name</span><span class="token variable operator" style="color:rgb(12, 150, 155)">=</span><span class="token variable" style="color:rgb(201, 103, 101)">instance-state-name,Values</span><span class="token variable operator" style="color:rgb(12, 150, 155)">=</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token variable" style="color:rgb(201, 103, 101)">running</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token variable" style="color:rgb(201, 103, 101)"> </span><span class="token variable operator" style="color:rgb(12, 150, 155)">|</span><span class="token variable" style="color:rgb(201, 103, 101)"> </span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">\</span><span class="token variable" style="color:rgb(201, 103, 101)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token variable" style="color:rgb(201, 103, 101)">  jq -r .Reservations</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token variable number" style="color:rgb(170, 9, 130)">0</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token variable" style="color:rgb(201, 103, 101)">.Instances</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token variable number" style="color:rgb(170, 9, 130)">0</span><span class="token variable punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token variable" style="color:rgb(201, 103, 101)">.PublicIpAddress</span><span class="token variable" style="color:rgb(201, 103, 101)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(17, 17, 17)">echo</span><span class="token plain"> Server accessible at </span><span class="token variable" style="color:rgb(201, 103, 101)">${PUBLIC_IP}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">ssh</span><span class="token plain"> -i login.pem -o </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;StrictHostKeyChecking no&quot;</span><span class="token plain"> ubuntu@</span><span class="token variable" style="color:rgb(201, 103, 101)">${PUBLIC_IP}</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">uname</span><span class="token plain"> -a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This diffing of original and desired state can be resolved several ways. The contracting company could spend a lot of time inspecting the existing commercial space to find absolutely every piece that can be re-used, removing them and setting them aside with the materials that need to be purchased, then rework the interior walls, and build everything from scratch, or it could decide to tear everything out back into an empty space and rebuild from scratch (like what your web browser does between web pages), or perhaps you need to keep the space mostly usable for customers, minimizing disruption to the current operations while things are changed. This last case is what infrastructure management tools need to tackle your infrastructure with the least amount of downtime or no downtime at all, if you&#x27;re <em>careful</em> with it.</p><p>How can you &quot;careful&quot; with declarative programming tools, if you don&#x27;t have direct control over what they do? Terraform does this with a <a href="https://developer.hashicorp.com/terraform/cli/commands/plan" target="_blank" rel="noopener noreferrer">plan</a> command, which performs the diffing of current and desired state and reports back to you the operations it expects to execute to do so. Terraform will tell you when a change it intends to make is going to provision new resources, alter existing resources, drop resources, and <em>replace</em> resources. That last one is particularly annoying when it shows up because it means the change you want to perform can only be done by dropping it and recreating it with the new configuration.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">$ terraform plan</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">data.external.example: Reading</span><span class="token punctuation" style="color:rgb(153, 76, 195)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">data.external.example: Read complete after 1s </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">id</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">-</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">Terraform used the selected providers to generate the following execution</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">plan. Resource actions are indicated with the following symbols:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  + create</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">Terraform will perform the following actions:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># aws_instance.login will be created</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  + resource </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;aws_instance&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + ami                                  </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;resolve:ssm:/aws/service/canonical/ubuntu/server/20.04/stable/current/amd64/hvm/ebs-gp2/ami-id&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + arn                                  </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + associate_public_ip_address          </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + availability_zone                    </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + cpu_core_count                       </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + cpu_threads_per_core                 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + disable_api_stop                     </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + disable_api_termination              </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + ebs_optimized                        </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + get_password_data                    </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + host_id                              </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + host_resource_group_arn              </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + iam_instance_profile                 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">id</span><span class="token plain">                                   </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + instance_initiated_shutdown_behavior </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + instance_state                       </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + instance_type                        </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;t3.small&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + ipv6_address_count                   </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + ipv6_addresses                       </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + key_name                             </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + monitoring                           </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + outpost_arn                          </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + password_data                        </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + placement_group                      </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + placement_partition_number           </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + primary_network_interface_id         </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + private_dns                          </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + private_ip                           </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + public_dns                           </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + public_ip                            </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + secondary_private_ips                </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + security_groups                      </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + source_dest_check                    </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + subnet_id                            </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + tags                                 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          + </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login-inst&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + tags_all                             </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          + </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login-inst&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + tenancy                              </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + user_data                            </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + user_data_base64                     </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + user_data_replace_on_change          </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + vpc_security_group_ids               </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># aws_key_pair.login will be created</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  + resource </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;aws_key_pair&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + arn             </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + fingerprint     </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">id</span><span class="token plain">              </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + key_name        </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + key_name_prefix </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + key_pair_id     </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + key_type        </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + public_key      </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIF4yiy4lef2WFQ7zdtuOZUHz9onyADTJ16l0OX8a211y damocles@zelbinion&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + tags_all        </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># aws_security_group.login_sg will be created</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  + resource </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;aws_security_group&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login_sg&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + arn                    </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + description            </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Login security group&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + egress                 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">id</span><span class="token plain">                     </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + ingress                </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          + </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              + cidr_blocks      </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  + </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;0.0.0.0/0&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              + description      </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              + from_port        </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              + ipv6_cidr_blocks </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              + prefix_list_ids  </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              + protocol         </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;tcp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              + security_groups  </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              + self             </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              + to_port          </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + name                   </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;login-sg&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + name_prefix            </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + owner_id               </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + revoke_rules_on_delete </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + tags_all               </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      + vpc_id                 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">known after apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">Plan: </span><span class="token number" style="color:rgb(170, 9, 130)">3</span><span class="token plain"> to add, </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token plain"> to change, </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token plain"> to destroy.</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">─────────────────────────────────────────────────────────────────────────────</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">Note: You didn</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;t use the -out option to save this plan, so Terraform can&#x27;</span><span class="token plain">t</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">guarantee to take exactly these actions </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> you run </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;terraform apply&quot;</span><span class="token plain"> now.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When you see steps where Terraform plans to drop or replace resources, you can decide if that&#x27;s actually alright, or if it will negatively impact your business during the deployment, and then you can abort and define an intermediate state to first transition to, usually creating a new resource without dropping the old one, then do whatever operation is necessary to move internal state to it, then continue by deleting the old resource. This is like checking up on your contracting company before they start doing their work to make sure they don&#x27;t do anything strange you don&#x27;t want, and sometimes needing to handhold them through details of your business to come up with the new plan of action.</p><p>Until cloud resource management is as quick to execute as a webpage render where state changes can be done faster than a human can respond, this sort of hand-holding is necessary for live infrastructure with uptime guarantees. Declarative programming, at least for cloud infrastructure management, is a <a href="https://en.wikipedia.org/wiki/Leaky_abstraction" target="_blank" rel="noopener noreferrer">leaky abstraction</a> over the imperative operations that need to be executed.</p><p>The Terraform HCL files don&#x27;t have the prior state encoded into them, nor does it depend on being stored within a git repository to provide that prior state, so how does Terraform get that initial state to operate on? Terraform maintains an <a href="https://developer.hashicorp.com/terraform/language/state" target="_blank" rel="noopener noreferrer">internal statefile</a> to perform the diffing against. It has a mechanism to <a href="https://developer.hashicorp.com/terraform/cli/commands/refresh" target="_blank" rel="noopener noreferrer">refresh that state</a>, but being a JSON blob with poor typing, can <a href="https://faun.pub/cleaning-up-a-terraform-state-file-the-right-way-ab509f6e47f3" target="_blank" rel="noopener noreferrer">become corrupted, requiring manual intervention</a>.</p><p>Why does Terraform need this JSON-based statefile when it has the much cleaner HCL format that you use as a developer? This is because HCL, as a language that provides affordances to the developer&#x27;s own intuition on how to structure their representation of their infrastructure, does not have a <a href="https://en.wikipedia.org/wiki/Canonical_form" target="_blank" rel="noopener noreferrer">canonical form</a> to make these comparisons with. Terraform must first pre-process the HCL into an internal data structure which it can then generate a <a href="https://en.wikipedia.org/wiki/Diff" target="_blank" rel="noopener noreferrer">diff</a> that can then be used to determine the operations to perform. The JSON-based statefile is likely a very close representation of this internal data structure, and manual editing of it is highly discouraged because the details of it likely vary from release to release with an internal migration mechanism performed on upgrade of the Terraform CLI.</p><p>Needing to learn Terraform&#x27;s HCL language to make infrastructure changes has been cited as a <a href="https://www.pulumi.com/why-pulumi/" target="_blank" rel="noopener noreferrer">weakness</a> that can be mitigated by wrapping it in the syntaxes more familiar to the user like <a href="https://developer.hashicorp.com/terraform/cdktf" target="_blank" rel="noopener noreferrer">Terraform CDK</a>, <a href="https://www.pulumi.com" target="_blank" rel="noopener noreferrer">Pulumi</a>, or <a href="https://docs.aws.amazon.com/cdk/v2/guide/home.html" target="_blank" rel="noopener noreferrer">AWS CDK</a>. This <em>is</em> a weakness, but we believe that the HCL-to-Statefile transformation being <a href="https://en.wikipedia.org/wiki/Surjective_function" target="_blank" rel="noopener noreferrer">surjective</a> instead of <a href="https://en.wikipedia.org/wiki/Bijection" target="_blank" rel="noopener noreferrer">bijective</a> is actually the bigger issue.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span><mdxadmonitiontitle>Surjective Function <em>f</em> Diagram</mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p><img loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/6/6c/Surjection.svg" alt="Surjective Diagram" class="img_CujE"></p><p><a href="https://en.wikipedia.org/wiki/Surjective_function#/media/File:Surjection.svg" target="_blank" rel="noopener noreferrer"><em>From Wikipedia</em></a> A function <em>f</em> is surjective if all of its inputs <em>X</em> map to all outputs <em>Y</em>, but overlaps can occur.</p><p>This is like multiple Terraform HCL representations all mapping to the exact same cloud infrastructure.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-objective-is-bi--hmmmm">The Objective is Bi- hmmmm....<a href="#the-objective-is-bi--hmmmm" class="hash-link" aria-label="Direct link to The Objective is Bi- hmmmm...." title="Direct link to The Objective is Bi- hmmmm....">​</a></h2><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span><mdxadmonitiontitle>Bijective Function <em>f</em> Diagram</mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p><img loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Bijection.svg" alt="Bijective Diagram" class="img_CujE"></p><p><a href="https://en.wikipedia.org/wiki/Bijection#/media/File:Bijection.svg" target="_blank" rel="noopener noreferrer"><em>From Wikipedia</em></a> A function <em>f</em> is bijective if all of its inputs <em>X</em> map to all outputs <em>Y</em> exactly once.</p></div></div><p>A bijective function has a one-to-one mapping of all state in one set with all state in another set. Both representations are equivalent (given the appropriate transform functions), both sets (of possible cloud states) are the same size (conceptually), and for any one particular state in one set there is exactly one state in the other set. Programming Languages don&#x27;t fit the bill here, as was demonstrated earlier, but what does? What, exactly, defines your cloud resources in the most minimal way?</p><p>The best answer in most cases is <del><a href="https://en.wikipedia.org/wiki/Cloud" target="_blank" rel="noopener noreferrer">water vapor</a></del> <a href="https://en.wikipedia.org/wiki/Entity#In_computer_science" target="_blank" rel="noopener noreferrer">Entities</a>. Each cloud resource has some unique identifier and a set of properties that configure it. Some of those properties can be relations or dependencies on other cloud resources. The ordering of the entities does not matter, so long as the dependencies are explicitly defined to make determination of the order of operations possible. You may have noticed that this sounds a lot like <a href="https://en.wikipedia.org/wiki/Object_%28computer_science%29" target="_blank" rel="noopener noreferrer">Objects</a> in <a href="https://en.wikipedia.org/wiki/Object-oriented_programming" target="_blank" rel="noopener noreferrer">Object-Oriented Programming</a>. It is very much the same, with the only difference being that the unique identifier <em>must</em> be unique, so if we considered an array of pointers to these objects as the entity IDs, multiple pointers to the same object wouldn&#x27;t be allowed.</p><p>This means the representation of your cloud resources should be <em>data</em>, not code. Particularly, it should be <a href="https://en.wikipedia.org/wiki/Relational_model" target="_blank" rel="noopener noreferrer">relational data</a> to allow the references/relations with other entities that actually exist within your cloud. Modeling each entity as a wholly-siloed object without those relations explicitly tracked <em>might</em> work for read-only cases, but puts the burden of properly joining the entities on the user and could lead to unexpected errors during mutation if the disjointed state is not carefully kept in sync. This mutation of that data would be the code, and fits very well into a classic <a href="https://www.redhat.com/en/blog/rest-architecture" target="_blank" rel="noopener noreferrer">REST architecture</a> (in the original sense, though it could also work in the <a href="https://en.wikipedia.org/wiki/Overview_of_RESTful_API_Description_Languages#Hypertext-driven_API" target="_blank" rel="noopener noreferrer">Web-oriented RESTful meaning</a>.</p><p>Since your infrastructure is actually data, just about any data format <em>could</em> be used to store it, as demonstrated by Terraform&#x27;s usage of JSON under-the-hood. Some will require more application-level guarantees on top of the data format to achieve all of the necessary components, however. For instance JSON does not have any native way to represent <em>references</em> to other JSON objects that are not wholly contained within the object in question, so you would need to define a way to represent them and enforce it within your application. <a href="https://yaml.org/spec/1.2.2/#24-tags" target="_blank" rel="noopener noreferrer">YAML does support them via tags</a> but being a markup language has multiple equivalent representations and is therefore not suitable for this purpose (without a strict linter to reduce it back down to a canonical form). There are also <a href="https://capnproto.org/language.html#dynamically-typed-fields" target="_blank" rel="noopener noreferrer">binary formats that can encode references</a> with <a href="https://www.sqlite.org/cli.html" target="_blank" rel="noopener noreferrer">SQLite&#x27;s file format</a> arguably being the most prolific.</p><p>SQL immediately stands out here because it was designed for making <a href="https://en.wikipedia.org/wiki/Relational_algebra" target="_blank" rel="noopener noreferrer">relational algebra</a>, the other side of the <a href="https://en.wikipedia.org/wiki/Entity%E2%80%93relationship_model" target="_blank" rel="noopener noreferrer">Entity-Relationship model</a>, accessible. There are likely more people who know SQL than any programming language (for IaC) or data format you could choose to represent your cloud infrastructure. Many non-programmers know it, as well, such as data scientists, business analysts, accountants, etc, and there is an entire ecosystem of useful functionality you gain &quot;for free&quot; by using a SQL representation than just about any format out there. Furthermore, a powerful SQL engine like the open source <a href="https://postgresql.org" target="_blank" rel="noopener noreferrer">PostgreSQL</a> provides tools capable of elevating the infrastructure management <em>experience</em> beyond what IaC can do today.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-advantages-of-sql-databases-for-infrastructure-management">The Advantages of SQL Databases for Infrastructure Management<a href="#the-advantages-of-sql-databases-for-infrastructure-management" class="hash-link" aria-label="Direct link to The Advantages of SQL Databases for Infrastructure Management" title="Direct link to The Advantages of SQL Databases for Infrastructure Management">​</a></h3><p>First, by defining <a href="https://www.postgresql.org/docs/current/tutorial-fk.html" target="_blank" rel="noopener noreferrer">foreign key relations</a> between tables, the database can immediately inform you if you have dependencies that must be created before you can create the resource you desire. It will simply return an error message to you if you have inserted an incomplete record missing any required fields.</p><p>&quot;But,&quot; you say, &quot;programming languages with solid type systems, like <a href="https://www.rust-lang.org" target="_blank" rel="noopener noreferrer">Rust</a>, can also do that for you.&quot; That is true, and this was not an attempt to disparage them, merely to show that you aren&#x27;t losing anything by using SQL as the representation. There are, however, ways SQL goes above and beyond. By defining <a href="https://www.postgresql.org/docs/current/ddl-constraints.html" target="_blank" rel="noopener noreferrer">unique, not-null, and check constraints</a> on top of a <a href="https://www.postgresql.org/docs/current/datatype.html" target="_blank" rel="noopener noreferrer">rich type system</a> the database can prevent you from inserting faulty data to a greater degree than even Rust, as the constraints can be against the live state of your infrastructure itself. Instead of code needing to deal with unexpected values further down the line, the faulty data can be prevented from ever being inserted. Rust&#x27;s compiler making sure that you handle every possible branch is an awesome thing, but SQL has the power to make more of these branches impossible in the first place.</p><p>By being in a database, you can answer questions about your infrastructure via queries, and in the case of security vulnerabilities or expensive misconfigurations you can update that state across the board at the same time. The shared, live nature of the SQL database more closely matches the reality of the cloud infrastructure, while the more malleable nature of the querying in the Structured Query Language lets you cross-check in many dimensions the AWS console does not.</p><p>There&#x27;s a further advantage by having a bijective relationship with your cloud: you can re-synchronize the database with your cloud at any time, avoiding statefile issues by never getting too out-of-date, and being almost impossible to corrupt. Software bugs are unavoidable, but since populating the database is trivial (compared to the cloud account itself), it could simply be dropped and recreated at any time without an impact on your own usage.</p><p>Most SQL databases have the concept of <a href="https://www.postgresql.org/docs/current/sql-createtrigger.html#SQL-CREATETRIGGER-EXAMPLES" target="_blank" rel="noopener noreferrer">trigger functions</a> that execute based on changes to the database itself. With a collection of automatically-created trigger functions, an <a href="https://en.wikipedia.org/wiki/Audit_trail" target="_blank" rel="noopener noreferrer">audit log</a> can be maintained, which can keep track of who made what cloud changes and when they did, going a step further than even a git repository of IaC changes, as changes done manually through the AWS console will also show up (though these would not have a database user to tie them to).</p><p>Trigger functions have other uses that don&#x27;t even have an analogous concept in IaC tooling. For instance, trigger functions can be added to automatically re-insert deleted records of sensitive cloud resources for automated <a href="https://en.wikipedia.org/wiki/Chaos_engineering" target="_blank" rel="noopener noreferrer">Chaos Engineering</a> recovery. Either a mutation that was attempted by a developer that shouldn&#x27;t be allowed (without also going through the much larger change of removing said trigger function first) so the resource is never deleted in the first place, as well as automatic recreation of the desired resource in the cloud if deleted via the AWS console or dropped during an outage.</p><p>SQL Database <a href="https://en.wikipedia.org/wiki/Snapshot_%28computer_storage%29" target="_blank" rel="noopener noreferrer">Snapshotting</a> could be used to quickly revert all infrastructure changes for infrastructure without hidden state (eg, the snapshot of your load balancers&#x27; prior state would successfully restore the load balancer configuration, but a dropped database restored via a snapshot would not restore the data within, only that you had such a database in the first place and you would still need to manually re-load a backup snapshot of those, as well).</p><p>Database engines also represent a standardized protocol to interface with your data. This standard opens up a world of possibilities that can encompass the imperative and declarative infrastructure management styles and go beyond them. You can:</p><ul><li>Perform operations on your database via scripts and the <a href="https://www.postgresql.org/docs/current/app-psql.html" target="_blank" rel="noopener noreferrer"><code>psql</code> CLI</a> tool, using whatever mix of declarative and imperative styles you prefer, mutating various tables declaratively and calling <a href="/docs/modules/aws/aws_sdk/?view=code-examples"><code>AWS SDK functions directly</code></a> where and when you see fit.</li><li>Integrate the database into your application itself with a <a href="https://node-postgres.com/" target="_blank" rel="noopener noreferrer">postgres client library</a> allowing your applications to make infrastructure changes (like provisioning sharded resources for a client that wants isolation, or using a more accurate forecasting model to pre-allocate more resources before the storm hits).</li><li>Connect with a <a href="https://www.jetbrains.com/datagrip/features/postgresql/" target="_blank" rel="noopener noreferrer">SQL IDE</a> for a variety of reasons, such as outage mitigation or inspection of your infrastructure in a tabular (Excel-like) view.</li><li>Connect the database to a <a href="https://grafana.com/docs/grafana/latest/datasources/postgres/" target="_blank" rel="noopener noreferrer">graphical dashboard</a> for live visualization of your infrastructure&#x27;s state and any other metadata transferred through.</li><li>Connect it to a <a href="https://docs.retool.com/docs/postgresql-integration" target="_blank" rel="noopener noreferrer">low code tool</a> for rapid response dashboards for your infrastructure with buttons you can tackle known outage vectors near-instantly, or just to make self-service provisioning of new microservices in the infrastructure team&#x27;s preferred way.</li></ul><p>There are negatives to representing your infrastructure as SQL, of course, as there is no perfect solution for all situations, but we believe <a href="https://iasql.com" target="_blank" rel="noopener noreferrer">IaSQL</a> is a superset versus IaC in all but one category.</p><p>SQL is an old, irregular language to work with, but it is better known than HCL and SQL already has it&#x27;s own Pulumi/CDK in the form of every ORM with introspection (like <a href="https://www.prisma.io/docs/concepts/components/introspection" target="_blank" rel="noopener noreferrer">Javascript&#x27;s Prisma</a>, <a href="https://docs.djangoproject.com/en/4.1/howto/legacy-databases/" target="_blank" rel="noopener noreferrer">Python&#x27;s Django</a>, <a href="https://github.com/xo/xo" target="_blank" rel="noopener noreferrer">Go&#x27;s XO</a> etc) and QueryBuilder (<a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/linq/" target="_blank" rel="noopener noreferrer">LINQ</a>, <a href="https://knexjs.org/" target="_blank" rel="noopener noreferrer">Knex</a>, etc) in whatever programming language you prefer. You probably already know it.</p><p>Peer review of changes is <em>different</em> versus IaC. Instead of writing HCL or other IaC code, having it reviewed, and then <code>apply</code>ing it, you can enter an <a href="/docs/transaction/">IaSQL transaction</a>, make the desired changes with Postgres acting as your IDE, automatically blocking many impossible changes via types and relations, and use <a href="/docs/review/"><code>iasql_create_review</code></a> to create a review artifact for your team <em>after</em> IaSQL has already vetted it for technical correctness. This vetting makes the result superior to the traditional peer review system in IaC.</p><p>Database schemas can be overwhelming, and a schema accurately representing <em>all</em> of AWS would be dizzying. HCL and other IaC tools let you elide parts of AWS via a module system, so we have implemented our own <a href="/docs/module/">module system</a> on top of Postgres inspired equally by programming language module systems and Linux distro package managers. This module system takes the place the usual database <a href="https://en.wikipedia.org/wiki/Schema_migration" target="_blank" rel="noopener noreferrer">schema migration system</a> for the management of the tables in the database, which may feel unusual at first, but we believe it is superior (for this use-case).</p><p>Even with IaC tools letting you ignore details you don&#x27;t specifically need, AWS and other clouds expose many details in multiple layers for you to control when often you just need the same subset of functionality over-and-over, so these IaC tools have higher-level modules for these cookie-cutter use-cases. For IaSQL we <a href="/docs/low-level-vs-high-level/">did the same</a>, though in a way that coexists with the lower-level modules so you can still query those details later, if you like. <a href="/blog/ecs-simplified/">Here</a> is an example of a high-level module that greatly simplifies ECS fargate. </p><p>IaSQL is declarative like IaC, so the leaky abstraction problem of declarative programming can still impact things. Like IaC&#x27;s <code>apply</code> concept IaSQL has <a href="/docs/transaction/">its own transaction system</a> (separate from the actual <a href="https://www.postgresql.org/docs/current/tutorial-transactions.html" target="_blank" rel="noopener noreferrer">database transaction system</a>) that will let you enqueue changes and preview what actions the engine will take before commiting to it (or rolling it back). Going beyond that and acknowledging that sometimes you need to directly work in the lower abstraction layer, IaSQL exposes optional <a href="https://iasql.com/docs/modules/aws/aws_sdk/" target="_blank" rel="noopener noreferrer">raw SDK access</a> within the database to handle those tougher situations, and can then re-synchronize the declarative state afterwards.</p><p>As IaSQL is able to both push changes from the database to the cloud and pull changes from the cloud to the database versus the one-way push from HCL that Terraform provides, you can make changes directly in the AWS console, then inspect the audit log directly or <a href="https://iasql.com/docs/modules/builtin/tables/iasql_functions_rpcs_iasql_get_sql_since.IasqlGetSqlSince/" target="_blank" rel="noopener noreferrer">call a special formatting function</a> to see what SQL statements were the equivalent of those console changes. This reduces the learning curve of IaSQL and also lowers the barrier to entry in comparison to IaC. You can continue using other cloud management tooling in conjunction with IaSQL (including to a degree IaC) and IaSQL will show you &quot;it&#x27;s way&quot; of doing the same when it syncs.</p><p>Finally, IaSQL makes your infrastructure <em>accessible</em> to a much large portion of your company than IaC tools can. Data Scientists who know SQL could help with the provisioning of their own batch processing code, EngSec can query <em>all</em> company infrastructure for security vulnerabilities and propose changes to improve things, Business Analysts in Growth teams can query actual traffic information from the live infrastructure (with read-only AWS credentials, of course), Finance auditors can query your infrastructure joined on pricing data and figure out <em>accurate</em> expense reporting per division, and DevOps can run queries joined on CloudWatch utilization stats to automatically identify overprovisioned services and create recommended auto-load scaling configuration changes. Tons of &quot;not-developer&quot; and &quot;developer-adjacent&quot; roles that can take over a lot of the ancillary burden of maintaining a production system.</p><p>But IaSQL is much newer than the IaC tools. We have coverage at the time of writing for 25 different AWS services, but that is admittedly far from complete. IaC tools also have cloud resources they cannot represent, but it is a much smaller percentage. This disadvantage will diminish over time, but creating a bijective entity representation of every cloud service requires more developer firepower than the approach IaC tools have taken, so we expect to always lag temporally on this front. At least, as long as AWS and friends don&#x27;t follow a resource-oriented standard like <a href="https://swagger.io/specification/" target="_blank" rel="noopener noreferrer">Swagger</a>.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Cloud APIs on Swagger?</div><div class="admonitionContent_S0QG"><p><img loading="lazy" alt="swagger-i-would-be-so-happy" src="/assets/images/swagger-i-would-be-so-happy-aeba78f4fcc9734f0215b78e9b946966.jpg" width="500" height="572" class="img_CujE"></p><p><em>Me too, Craig, me too...</em></p></div></div><p>With that said, what does our EC2 instance example look like in IaSQL, uh, SQL?</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- Assuming that the AWS credentials have already been inserted as done during the setup wizard</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> default_aws_region</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;us-west-2&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- Install the necessary modules</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> iasql_install</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;aws_ec2&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;aws_ec2_metadata&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;ssh_accounts&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- Create the key-pair and put it in our ssh_credentials table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- We will update this later with the public IP address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> ssh_credentials </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> username</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> private_key</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;login&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;tbd&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;ubuntu&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> privateKey </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> key_pair_request</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;login&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;us-west-2&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- Start an IaSQL transaction so these changes don&#x27;t mutate our infrastructure immediately</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> iasql_begin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- Define the security group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> security_group </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">description</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> group_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;Login security group&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;login-sg&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- And it&#x27;s ingress rule</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> security_group_rule </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">is_egress</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> ip_protocol</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> from_port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> to_port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> cidr_ipv4</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> security_group_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;tcp&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">22</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">22</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;0.0.0.0/0&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> security_group</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> group_name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;login-sg&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- Define the instance and the key-pair to use</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> instance </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ami</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> instance_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> key_pair_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> tags</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> subnet_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;resolve:ssm:/aws/service/canonical/ubuntu/server/20.04/stable/current/amd64/hvm/ebs-gp2/ami-id&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;t3.small&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;login&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;{&quot;name&quot;:&quot;login&quot;}&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> subnet</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> availability_zone </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;us-west-2a&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- Associate the instance with the security group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> instance_security_groups </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">instance_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> security_group_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> id </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> instance </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> tags </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;login&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> id </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> security_group </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> group_name</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;login-sg&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;us-west-2&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can then <code>SELECT * FROM iasql_preview();</code> to see what this does, like a <code>terraform plan</code>:</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span><mdxadmonitiontitle><code>iasql_preview</code> output</mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><table><thead><tr><th align="left">action</th><th align="left">table_name</th><th align="right">id</th><th align="right">description</th></tr></thead><tbody><tr><td align="left">create</td><td align="left">instance</td><td align="right">1</td><td align="right">1</td></tr><tr><td align="left">create</td><td align="left">security_group</td><td align="right">18</td><td align="right">18</td></tr><tr><td align="left">create</td><td align="left">security_group_rule</td><td align="right">1</td><td align="right">1</td></tr></tbody></table></div></div><p>This is a &quot;high level&quot; overview with minimal details. We can get back a listing of all changes, represented in auto-generated SQL with <code>SELECT * FROM iasql_get_sql_for_transaction();</code></p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> security_group </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">description</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> group_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> region</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;Login security group&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;login-sg&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> region </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> aws_regions </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;us-west-2&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> security_group_rule </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">is_egress</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> ip_protocol</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> from_port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> to_port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> cidr_ipv4</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> region</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> security_group_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;f&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;tcp&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;22&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;22&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;0.0.0.0/0&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> region </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> aws_regions </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;us-west-2&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> id </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> security_group </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> group_id </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> region </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> aws_regions </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;us-west-2&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> instance </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ami</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> instance_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> key_pair_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> tags</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> hibernation_enabled</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> region</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> subnet_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;resolve:ssm:/aws/service/canonical/ubuntu/server/20.04/stable/current/amd64/hvm/ebs-gp2/ami-id&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;t3.small&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;login&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;running&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;{&quot;name&quot;:&quot;login&quot;}&#x27;</span><span class="token plain">::jsonb</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;f&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> region </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> aws_regions </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;us-west-2&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> id </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> subnet </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> subnet_id </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;subnet-06140fd708a495450&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> region </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> aws_regions </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;us-west-2&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> instance_security_groups </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">instance_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> security_group_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> id </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> instance </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> instance_id </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> region </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> aws_regions </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;us-west-2&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> id </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> security_group </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> group_id </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> region </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> aws_regions </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;us-west-2&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>which in this case is very similar to (though a bit more verbose than) our original SQL statements, but if you were going back and forth on what exact changes you&#x27;re going to make, it can be a good summary.</p><p>If we&#x27;re good with this, we can <code>SELECT iasql_commit()</code> to push this to our cloud account and then update our <code>ssh_credentials</code> record with the public IP address and check the connection:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">WITH</span><span class="token plain"> h </span><span class="token keyword" style="color:rgb(12, 150, 155)">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> host</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">im</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">public_ip_address</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">AS</span><span class="token plain"> hostname</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> instance_metadata im</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">JOIN</span><span class="token plain"> instance i </span><span class="token keyword" style="color:rgb(12, 150, 155)">ON</span><span class="token plain"> im</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">instance_id </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">instance_id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">tags </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;login&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">UPDATE</span><span class="token plain"> ssh_credentials </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> hostname </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> h</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">hostname </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> ssh_credentials</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> h </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> hostname </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;tbd&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> ssh_exec</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;login&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;uname -a&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sql-is-the-least-bad-option-for-infrastructure-management">SQL is the least bad option for Infrastructure Management<a href="#sql-is-the-least-bad-option-for-infrastructure-management" class="hash-link" aria-label="Direct link to SQL is the least bad option for Infrastructure Management" title="Direct link to SQL is the least bad option for Infrastructure Management">​</a></h2><p>Infrastructure Management is a complex beast. The cloud APIs are massive with a rich collection of knobs to tweak, and mistakes can be dangerous because the changes often take a long time and recovery even more so. We have learned about the two main types of infrastructure management: imperative and declarative, where ad-hoc usage of the AWS console fits under the imperative umbrella along with scripts calling an SDK, while IaC has until recently been the only way to declaratively manage your infrastructure.</p><p>Both imperative and declarative styles have their downsides. Imperative being more explicit makes it more tedious and more prone to error, and the usual execution frequency of <em>only once</em> for most production changes makes scripting usually no better than clicking around in the AWS console. Declarative is much less tedious, but because it is a leaky abstraction inspecting its execution plan is critical to make sure it doesn&#x27;t automatically put you into an outage, and failures during application can still require falling back to imperative mode to get things back into shape from time-to-time.</p><p>Also until recently, all declarative approaches have suffered from only being a one-way transition, from your IaC codebase into the cloud, but no good or easy way to synchronize that code with the current state of the cloud if they drift from each other. Because these declarative programming approaches do not have a singular canonical form, they can&#x27;t be bijective, making the transform back from the other side impossible to square up.</p><p>Data, on the other hand, is much easier to normalize in such a way, and relational data models, as found in SQL databases, can naturally model the relationships between cloud services, making it possible to produce a bijective representation. IaSQL takes advantage of this to make a declarative model based on tables and foreign keys that can automatically handle changes done outside of this declarative model, either by dropping down into its own imperative mode or by using any other tooling to manage your infrastructure, giving it a flexibility and resiliency that IaC tools don&#x27;t have.</p><p>On top of this foundation, tooling to replicate or substitute for existing IaC tooling has been added, along with all of the past ~50 years of database tooling and expertise that you can take advantage of, providing a superset of functionality that makes existing use-cases easier and new use-cases possible.</p><p>IaSQL is <a href="/blog/beta/">currently in beta</a> and can be used locally with <a href="https://hub.docker.com/r/iasql/iasql" target="_blank" rel="noopener noreferrer"><code>docker</code></a>. We&#x27;re proud of what we have built, and can&#x27;t wait to hear from you on feature requests and bug reports.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/deep-dives/">deep-dives</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/alantech/iasql/tree/main/site/blog/deep-dives/why-sql-for-infrastructure.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/deploy-stable-diffusion/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Deploy Stable Diffusion in EC2 using a SQL query</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#following-these-instructions-is-imperative" class="table-of-contents__link toc-highlight">Following these instructions is imperative</a></li><li><a href="#declare-your-intentions-at-once" class="table-of-contents__link toc-highlight">Declare your intentions at once</a></li><li><a href="#the-objective-is-bi--hmmmm" class="table-of-contents__link toc-highlight">The Objective is Bi- hmmmm....</a><ul><li><a href="#the-advantages-of-sql-databases-for-infrastructure-management" class="table-of-contents__link toc-highlight">The Advantages of SQL Databases for Infrastructure Management</a></li></ul></li><li><a href="#sql-is-the-least-bad-option-for-infrastructure-management" class="table-of-contents__link toc-highlight">SQL is the least bad option for Infrastructure Management</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Product</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/alantech/iasql" target="_self" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><div class="footer__title">Content</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/docs/">Docs</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/blog/">Blog</a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.d268cc66.js"></script>
<script src="/assets/js/main.7045c60e.js"></script>
</body>
</html>