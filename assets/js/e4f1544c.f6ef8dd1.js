"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9348],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>u});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},_=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(a),_=o,u=p["".concat(l,".").concat(_)]||p[_]||h[_]||r;return a?n.createElement(u,i(i({ref:t},d),{},{components:a})):n.createElement(u,i({ref:t},d))}));function u(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=_;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}_.displayName="MDXCreateElement"},44841:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var n=a(87462),o=(a(67294),a(3905));const r={sidebar_position:3,slug:"/transaction"},i="IaSQL transactions at a high level",s={unversionedId:"concepts/transaction",id:"version-0.1.9/concepts/transaction",title:"IaSQL transactions at a high level",description:"IaSQL does not need any special syntax, akin to apply in IaC, to work normally. You can just SELECT/INSERT/UPDATE/DELETE records and eventually the changes are reflected in your cloud account. The most basic architectural diagram is simply your IaSQL database and your cloud account with IaSQL in between.",source:"@site/versioned_docs/version-0.1.9/concepts/transaction.md",sourceDirName:"concepts",slug:"/transaction",permalink:"/docs/transaction",draft:!1,editUrl:"https://github.com/alantech/iasql/tree/main/site/versioned_docs/version-0.1.9/concepts/transaction.md",tags:[],version:"0.1.9",sidebarPosition:3,frontMatter:{sidebar_position:3,slug:"/transaction"},sidebar:"docs",previous:{title:"Module",permalink:"/docs/module"},next:{title:"Low-Level vs High-Level Modules",permalink:"/docs/low-level-vs-high-level"}},l={},c=[{value:"IaSQL Transactions with <code>iasql_begin</code> and <code>iasql_commit</code>",id:"iasql-transactions-with-iasql_begin-and-iasql_commit",level:2},{value:"<code>iasql_preview</code>",id:"iasql_preview",level:2},{value:"<code>iasql_rollback</code>",id:"iasql_rollback",level:2}],d={toc:c},p="wrapper";function h(e){let{components:t,...a}=e;return(0,o.kt)(p,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"iasql-transactions-at-a-high-level"},"IaSQL transactions at a high level"),(0,o.kt)("p",null,"IaSQL does not need any special syntax, akin to ",(0,o.kt)("inlineCode",{parentName:"p"},"apply")," in IaC, to work normally. You can just ",(0,o.kt)("inlineCode",{parentName:"p"},"SELECT/INSERT/UPDATE/DELETE")," records and eventually the changes are reflected in your cloud account. The most basic architectural diagram is simply your IaSQL database and your cloud account with IaSQL in between."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"   ______\n  /      \\       _______            __\n  |\\____/|      |       |       ___/  \\__\n  |  DB  | <==> | IaSQL | <==> /  Cloud  \\\n  |      |      |_______|      \\_    _   /\n  \\______/                       \\__/ \\_/\n")),(0,o.kt)("p",null,"In both directions, though, IaSQL needs to be aware of what already exists on the other side in order to make only the calls necessary to produce the desired mutation on the other side."),(0,o.kt)("p",null,"Traditional IaC tools like Terraform use an internal statefile for this purpose, but this is folly. If there is ever an unexpected change, such as from an outage (or the manual mitigation of an outage) this statefile will not represent the other side correctly so the mutations it attempts will be incorrect causing the change to fail."),(0,o.kt)("p",null,"IaSQL, on the other hand, is completely stateless. It acquires the state of both the database and the cloud when asked to perform a change in either direction and then determines the work it will do based on the ",(0,o.kt)("em",{parentName:"p"},"true state")," of both."),(0,o.kt)("h2",{id:"iasql-transactions-with-iasql_begin-and-iasql_commit"},"IaSQL Transactions with ",(0,o.kt)("inlineCode",{parentName:"h2"},"iasql_begin")," and ",(0,o.kt)("inlineCode",{parentName:"h2"},"iasql_commit")),(0,o.kt)("p",null,"It is possible to perform changes to your cloud account synchronously by temporarily turning off the normal two-way propagation between the cloud and database through the usage of an IaSQL transaction using the provided PostgreSQL function ",(0,o.kt)("inlineCode",{parentName:"p"},"iasql_begin"),". This lets you batch, or stage, changes together and then calling ",(0,o.kt)("inlineCode",{parentName:"p"},"iasql_commit")," to mark the end of the transaction and propagate the changes from the database to the cloud account akin to a traditional ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Database_transaction"},"database transaction"),". And similarly to database transactions, IaSQL transactions automatically roll back if the ",(0,o.kt)("inlineCode",{parentName:"p"},"commit")," fails which can happen if there was a typo in your SQL or if the cloud provider behaves unpredictably."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"   ______\n  /      \\       _______            __\n  |\\____/|      |       |       ___/  \\__\n  |  DB  | ===> | IaSQL | ===> /  Cloud  \\\n  |      |      |_______|      \\_    _   /\n  \\______/                       \\__/ \\_/\n")),(0,o.kt)("p",null,"The way this works under the hood is that IaSQL has a cron job that makes sure to keep the two way synchronization between the database and the cloud that is paused while an IaSQL transaction is in progress."),(0,o.kt)("h2",{id:"iasql_preview"},(0,o.kt)("inlineCode",{parentName:"h2"},"iasql_preview")),(0,o.kt)("p",null,"IaSQL lets you visualize proposed changes for an ongoing IaSQL transaction to see how the database will update the cloud with the new data model using the ",(0,o.kt)("inlineCode",{parentName:"p"},"iasql_preview")," function which returns a virtual table of database records."),(0,o.kt)("h2",{id:"iasql_rollback"},(0,o.kt)("inlineCode",{parentName:"h2"},"iasql_rollback")),(0,o.kt)("p",null,"You can abort a transaction if you want to discard the changes done since calling ",(0,o.kt)("inlineCode",{parentName:"p"},"iasql_begin")," with ",(0,o.kt)("inlineCode",{parentName:"p"},"iasql_rollback")," by syncing the database with the state of the cloud again into the database. The transaction will be stopped and regular behaviour of IaSQL re-enabled in which changes are propagated both ways in an eventually consistent way without any special syntax other than ",(0,o.kt)("inlineCode",{parentName:"p"},"SELECT/INSERT/UPDATE/DELETE")," records normally."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"   ______\n  /      \\       _______            __\n  |\\____/|      |       |       ___/  \\__\n  |  DB  | <=== | IaSQL | <=== /  Cloud  \\\n  |      |      |_______|      \\_    _   /\n  \\______/                       \\__/ \\_/\n")))}h.isMDXComponent=!0}}]);